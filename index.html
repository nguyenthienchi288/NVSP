<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bài tập củng cố: Chia sẻ tệp & thư mục (Windows)</title>

  <!-- Bootstrap 5 + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --brand: #0d6efd;
    }
    body{
      background: #f6f8fb;
    }
    .navbar{
      background: linear-gradient(135deg, var(--brand), #6ea8fe);
    }
    .hero{
      background: white;
      border-radius: 1rem;
      box-shadow: 0 8px 24px rgba(0,0,0,.06);
      padding: 1.25rem 1.25rem;
    }
    .card-activity{
      border: none;
      border-radius: 1rem;
      box-shadow: 0 10px 28px rgba(0,0,0,.07);
    }
    .badge-soft{
      background: rgba(13,110,253,.12);
      color: #0d6efd;
      border: 1px dashed #a3c3ff;
    }
    /* Drag items */
    .sortable-list{
      list-style: none;
      padding-left: 0;
    }
    .sortable-item{
      background: #fff;
      border: 1px solid #e9eefb;
      border-radius: .75rem;
      padding: .75rem .9rem;
      margin-bottom: .6rem;
      display: flex; gap:.6rem; align-items: center;
      cursor: grab;
      transition: transform .06s ease;
    }
    .sortable-item:active{ cursor: grabbing; transform: scale(.995); }
    .sortable-item .handle{
      font-size: 1.2rem; color: #7b8aa0;
    }
    .drag-over{
      outline: 2px dashed #0d6efd;
      background: #eef5ff;
    }
    .drop-target{
      min-height: 44px;
      padding: .25rem;
      border: 2px dashed #cfe2ff;
      border-radius: .75rem;
      background: #f8fbff;
    }
    .choice{ 
      border: 1px solid #e9eefb; border-radius: .75rem; 
      padding:.75rem; margin:.5rem 0; background:#fff;
    }
    .choice.correct{ border-color: #25a244; box-shadow: 0 0 0 3px rgba(37,162,68,.12); }
    .choice.incorrect{ border-color: #dc3545; box-shadow: 0 0 0 3px rgba(220,53,69,.12); }
    .pill{
      display:inline-block; padding:.3rem .6rem; border-radius:999px;
      background:#eef2ff; border:1px solid #d6defa; color:#3957e6; font-size:.9rem;
    }
    .reveal{
      background:#f1f6ff; border:1px dashed #a9c6ff; border-radius:.75rem; padding:.75rem; display:none;
    }
    .perm-chip{
      display:inline-flex; align-items:center; gap:.35rem; padding:.35rem .6rem; 
      border-radius:999px; background:#e8fff3; border:1px solid #b6f2cf; color:#1e7f49; font-weight:600;
    }
    .perm-chip.read{ background:#f3f7ff; border-color:#cfe2ff; color:#1a4fbf; }
    .score-bubble{
      font-weight:700; background:#fff; border-radius:999px; padding:.4rem .8rem; border:1px solid #e9eefb;
      box-shadow: 0 8px 24px rgba(0,0,0,.06);
    }
    .footnote{
      color:#6c7a91; font-size:.9rem;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-dark">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#">
        <i class="bi bi-folder-symlink-fill me-2"></i> Chia sẻ tệp & thư mục — Bài tập củng cố
      </a>
      <span class="text-white-50 small d-none d-md-inline">Tương thích di động • Phản hồi tức thì</span>
    </div>
  </nav>

  <main class="container my-4">
    <!-- Hero -->
    <section class="hero mb-4">
      <div class="d-flex flex-column flex-lg-row align-items-start align-items-lg-center justify-content-between gap-3">
        <div>
          <div class="d-flex align-items-center gap-2 mb-2">
            <span class="badge badge-soft rounded-pill">Nhiệm vụ 2 & 3</span>
            <span class="pill">Windows • File Explorer • Sharing</span>
          </div>
          <h1 class="h4 mb-2">Mục tiêu</h1>
          <p class="mb-0">Củng cố thao tác <strong>chia sẻ thư mục (Sharing)</strong>, thiết lập <span class="perm-chip read"><i class="bi bi-eye"></i> Read</span> / <span class="perm-chip"><i class="bi bi-pencil-square"></i> Read/Write</span>, truy cập từ máy khác trong mạng, và <strong>hủy chia sẻ (Advanced Sharing)</strong>.</p>
        </div>
        <div class="d-flex align-items-center gap-2">
          <span class="score-bubble" id="scoreBubble" aria-live="polite">Điểm: 0</span>
          <button class="btn btn-outline-secondary" id="btnReset">
            <i class="bi bi-arrow-counterclockwise me-1"></i>Làm lại
          </button>
        </div>
      </div>
    </section>

    <!-- ACTIVITY 1: Reorder steps -->
    <section class="card card-activity mb-4">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
          <h2 class="h5 mb-0">1) Sắp xếp đúng thứ tự: <small class="text-muted">Chia sẻ thư mục cho <em>Everyone</em></small></h2>
          <div>
            <button class="btn btn-sm btn-outline-primary" id="checkOrder"><i class="bi bi-check2-circle me-1"></i>Chấm</button>
            <button class="btn btn-sm btn-outline-dark" id="revealOrder"><i class="bi bi-key me-1"></i>Xem đáp án</button>
          </div>
        </div>
        <p class="mb-3 footnote">Kéo thả để sắp xếp các bước đúng quy trình.</p>

        <ul id="orderList" class="sortable-list" aria-label="Kéo thả sắp xếp">
          <!-- Items will be injected by JS with a shuffled order -->
        </ul>
        <div id="orderFeedback" class="mt-2" aria-live="polite"></div>

        <div class="reveal mt-3" id="orderReveal">
          <ol class="mb-0">
            <li><strong>Mở Properties</strong>: Nhấp phải thư mục → <em>Properties</em> → thẻ <em>Sharing</em>.</li>
            <li><strong>Nhấp Share…</strong> trong phần <em>Network File and Folder Sharing</em>.</li>
            <li><strong>Chọn Everyone → Add</strong> trong cửa sổ <em>Choose people to share with</em>.</li>
            <li><strong>Thiết lập Permission</strong>: <em>Read</em> hoặc <em>Read/Write</em> → <strong>Share</strong>.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- ACTIVITY 2: MCQ -->
    <section class="card card-activity mb-4">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
          <h2 class="h5 mb-0">2) Trắc nghiệm nhanh</h2>
          <div>
            <button class="btn btn-sm btn-outline-primary" id="checkMCQ"><i class="bi bi-check2-circle me-1"></i>Chấm</button>
            <button class="btn btn-sm btn-outline-dark" id="revealMCQ"><i class="bi bi-key me-1"></i>Xem đáp án</button>
          </div>
        </div>
        <div class="mt-3">
          <div class="mb-3">
            <p class="mb-2 fw-semibold">2.1 Khi chọn <em>Everyone</em> và để mặc định <em>Permission Level = Read</em>, người dùng trong mạng có thể:</p>
            <div class="choice">
              <label class="d-flex align-items-start gap-2">
                <input type="radio" name="q1" value="A" class="form-check-input mt-1">
                <span>Chỉ xem và sao chép, không sửa hoặc xóa tệp.</span>
              </label>
            </div>
            <div class="choice">
              <label class="d-flex align-items-start gap-2">
                <input type="radio" name="q1" value="B" class="form-check-input mt-1">
                <span>Toàn quyền sửa/xóa/đổi tên tệp.</span>
              </label>
            </div>
            <div class="choice">
              <label class="d-flex align-items-start gap-2">
                <input type="radio" name="q1" value="C" class="form-check-input mt-1">
                <span>Không thể nhìn thấy thư mục chia sẻ.</span>
              </label>
            </div>
          </div>

          <div class="mb-3">
            <p class="mb-2 fw-semibold">2.2 Để cho phép sửa nội dung trong thư mục chia sẻ, cần đặt <em>Permission Level</em> là:</p>
            <div class="choice">
              <label class="d-flex align-items-start gap-2">
                <input type="radio" name="q2" value="A" class="form-check-input mt-1">
                <span>Read</span>
              </label>
            </div>
            <div class="choice">
              <label class="d-flex align-items-start gap-2">
                <input type="radio" name="q2" value="B" class="form-check-input mt-1">
                <span>Read/Write</span>
              </label>
            </div>
            <div class="choice">
              <label class="d-flex align-items-start gap-2">
                <input type="radio" name="q2" value="C" class="form-check-input mt-1">
                <span>Hidden</span>
              </label>
            </div>
          </div>

          <div class="mb-2">
            <p class="mb-2 fw-semibold">2.3 Biểu tượng thư mục chia sẻ trong <em>Network</em> thường hiển thị:</p>
            <div class="choice">
              <label class="d-flex align-items-start gap-2">
                <input type="radio" name="q3" value="A" class="form-check-input mt-1">
                <span>Một dây cáp/đường gạch nhỏ màu xanh bên cạnh thư mục.</span>
              </label>
            </div>
            <div class="choice">
              <label class="d-flex align-items-start gap-2">
                <input type="radio" name="q3" value="B" class="form-check-input mt-1">
                <span>Biểu tượng thùng rác.</span>
              </label>
            </div>
            <div class="choice">
              <label class="d-flex align-items-start gap-2">
                <input type="radio" name="q3" value="C" class="form-check-input mt-1">
                <span>Biểu tượng chìa khóa màu đỏ.</span>
              </label>
            </div>
          </div>
          <div id="mcqFeedback" class="mt-2" aria-live="polite"></div>

          <div class="reveal mt-3" id="mcqReveal">
            <ul class="mb-0">
              <li><strong>2.1</strong> → Đáp án <strong>A</strong>: Read chỉ cho phép xem/sao chép.</li>
              <li><strong>2.2</strong> → Đáp án <strong>B</strong>: Cho phép xem & sửa (Read/Write).</li>
              <li><strong>2.3</strong> → Đáp án <strong>A</strong>: Thư mục chia sẻ có dấu hiệu dây cáp xanh.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- ACTIVITY 3: Drag & drop match -->
    <section class="card card-activity mb-4">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
          <h2 class="h5 mb-0">3) Kéo-thả ghép khái niệm</h2>
          <div>
            <button class="btn btn-sm btn-outline-primary" id="checkMatch"><i class="bi bi-check2-circle me-1"></i>Chấm</button>
            <button class="btn btn-sm btn-outline-dark" id="revealMatch"><i class="bi bi-key me-1"></i>Xem đáp án</button>
          </div>
        </div>
        <p class="footnote mb-3">Kéo thả thẻ <em>Khái niệm</em> sang đúng <em>Mô tả</em>.</p>

        <div class="row g-3">
          <div class="col-lg-4">
            <h6 class="mb-2">Khái niệm</h6>
            <div id="bank" class="drop-target" aria-label="Ngân hàng thẻ kéo thả">
              <!-- tokens injected by JS -->
            </div>
          </div>
          <div class="col-lg-8">
            <h6 class="mb-2">Mô tả (thả thẻ vào đúng dòng)</h6>
            <div class="list-group">
              <div class="list-group-item d-flex flex-column flex-md-row align-items-start align-items-md-center gap-2">
                <div class="fw-semibold flex-grow-1">Network File and Folder Sharing</div>
                <div class="drop-target flex-grow-1" data-accept="network" aria-label="Ô thả: Network Sharing"></div>
              </div>
              <div class="list-group-item d-flex flex-column flex-md-row align-items-start align-items-md-center gap-2">
                <div class="fw-semibold flex-grow-1">Advanced Sharing…</div>
                <div class="drop-target flex-grow-1" data-accept="advanced" aria-label="Ô thả: Advanced Sharing "></div>
              </div>
              <div class="list-group-item d-flex flex-column flex-md-row align-items-start align-items-md-center gap-2">
                <div class="fw-semibold flex-grow-1">Password Protection</div>
                <div class="drop-target flex-grow-1" data-accept="password" aria-label="Ô thả: Password Protection"></div>
              </div>
              <div class="list-group-item d-flex flex-column flex-md-row align-items-start align-items-md-center gap-2">
                <div class="fw-semibold flex-grow-1">Everyone</div>
                <div class="drop-target flex-grow-1" data-accept="everyone" aria-label="Ô thả: Everyone"></div>
              </div>
            </div>
          </div>
        </div>

        <div id="matchFeedback" class="mt-3" aria-live="polite"></div>

        <div class="reveal mt-3" id="matchReveal">
          <ul class="mb-0">
            <li><strong>Network File and Folder Sharing</strong> → Chia sẻ nhanh qua nút <em>Share…</em>.</li>
            <li><strong>Advanced Sharing…</strong> → Thiết lập nâng cao, <em>Share this folder</em>, hủy chia sẻ.</li>
            <li><strong>Password Protection</strong> → Yêu cầu xác thực khi truy cập chia sẻ.</li>
            <li><strong>Everyone</strong> → Nhóm người dùng trong mạng nội bộ.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- ACTIVITY 4: Scenario - permission -->
    <section class="card card-activity mb-4">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
          <h2 class="h5 mb-0">4) Tình huống phân quyền</h2>
          <button class="btn btn-sm btn-outline-primary" id="checkScenario"><i class="bi bi-check2-circle me-1"></i>Chấm</button>
        </div>
        <p class="footnote mb-3">Chọn quyền phù hợp cho từng nhu cầu.</p>

        <div class="row g-3">
          <div class="col-md-6">
            <div class="p-3 border rounded-3 bg-white h-100">
              <div class="d-flex align-items-center gap-2 mb-1">
                <i class="bi bi-people-fill"></i><span class="fw-semibold">Chia sẻ tài liệu tham khảo</span>
              </div>
              <p class="mb-2">Các bạn lớp khác chỉ được xem & tải về, không sửa.</p>
              <select class="form-select scenario" data-answer="Read">
                <option value="">— Chọn Permission Level —</option>
                <option>Read</option>
                <option>Read/Write</option>
              </select>
              <div class="mt-2 small" aria-live="polite"></div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="p-3 border rounded-3 bg-white h-100">
              <div class="d-flex align-items-center gap-2 mb-1">
                <i class="bi bi-pencil-square"></i><span class="fw-semibold">Thư mục dự án nhóm</span>
              </div>
              <p class="mb-2">Mọi thành viên cần thêm/sửa/xóa file.</p>
              <select class="form-select scenario" data-answer="Read/Write">
                <option value="">— Chọn Permission Level —</option>
                <option>Read</option>
                <option>Read/Write</option>
              </select>
              <div class="mt-2 small" aria-live="polite"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ACTIVITY 5: Short answer (unshare) -->
    <section class="card card-activity mb-4">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
          <h2 class="h5 mb-0">5) Câu hỏi ngắn: Hủy chia sẻ như thế nào?</h2>
          <div>
            <button class="btn btn-sm btn-outline-primary" id="checkShort"><i class="bi bi-check2-circle me-1"></i>Chấm</button>
            <button class="btn btn-sm btn-outline-dark" id="revealShort"><i class="bi bi-key me-1"></i>Gợi ý</button>
          </div>
        </div>
        <p class="footnote mb-2">Mô tả ngắn gọn các bước hủy chia sẻ thư mục trong Windows (<em>Advanced Sharing</em>).</p>
        <textarea id="shortAns" class="form-control" rows="3" placeholder="Viết các bước..."></textarea>
        <div id="shortFeedback" class="mt-2" aria-live="polite"></div>

        <div class="reveal mt-3" id="shortReveal">
          <ol class="mb-0">
            <li>Nhấp phải thư mục → <strong>Properties</strong> → thẻ <strong>Sharing</strong> → <strong>Advanced Sharing…</strong></li>
            <li>Bỏ dấu <em>✓</em> ở <strong>Share this folder</strong> → <strong>Apply/OK</strong>.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- Footer actions -->
    <section class="text-center mb-5">
      <button class="btn btn-lg btn-primary" id="gradeAll">
        <i class="bi bi-trophy-fill me-1"></i> Chấm tất cả & tính điểm
      </button>
      <div class="mt-2 footnote">Mẹo: Sau khi hoàn tất, bạn có thể chụp màn hình nộp kết quả.</div>
    </section>
  </main>

  <footer class="py-4 border-top">
    <div class="container small text-muted">
      <div class="d-flex flex-column flex-md-row justify-content-between gap-2">
        <div><strong>Ghi chú an toàn:</strong> Sau khi thực hành, hãy kiểm tra quyền truy cập và tắt các chia sẻ không cần thiết.</div>
        <div>Thiết kế: Bootstrap • Tối ưu cho di động</div>
      </div>
    </div>
  </footer>

  <script>
    // -----------------------------
    // Shared scoring state
    // -----------------------------
    let totalScore = 0;
    function updateScoreBubble(){
      document.getElementById('scoreBubble').textContent = "Điểm: " + totalScore;
    }
    function addPoints(n){
      totalScore += n; updateScoreBubble();
    }
    function resetPoints(){
      totalScore = 0; updateScoreBubble();
    }

    // Utility to show temp feedback
    function toast(elem, html, color="primary"){
      elem.innerHTML = '<span class="text-'+color+'"><i class="bi bi-info-circle me-1"></i>'+html+'</span>';
    }

    // -----------------------------
    // Activity 1: Reorder steps
    // -----------------------------
    const orderSteps = [
      { id: "s1", text: "Mở Properties: Nhấp phải thư mục → Properties → thẻ Sharing" },
      { id: "s2", text: "Nhấp nút Share… trong mục Network File and Folder Sharing" },
      { id: "s3", text: "Chọn Everyone → Add; đặt Permission (Read/Read-Write)" },
      { id: "s4", text: "Nhấp Share để xác nhận chia sẻ" },
    ];
    const correctOrder = orderSteps.map(s => s.id); // ["s1","s2","s3","s4"]

    const orderList = document.getElementById('orderList');
    function shuffle(arr){ return arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]); }
    function renderOrder(shuffled=true){
      orderList.innerHTML = "";
      (shuffled ? shuffle(orderSteps) : orderSteps).forEach(step=>{
        const li = document.createElement('li');
        li.className = 'sortable-item';
        li.draggable = true;
        li.dataset.id = step.id;
        li.innerHTML = '<span class="handle bi bi-grip-vertical" aria-hidden="true"></span><span>'+step.text+'</span>';
        orderList.appendChild(li);
      });
      attachDragHandlers([...orderList.children]);
    }
    function attachDragHandlers(items){
      let dragSrc = null;
      items.forEach(item=>{
        item.addEventListener('dragstart', e=>{ dragSrc = item; item.classList.add('dragging'); e.dataTransfer.effectAllowed = 'move'; });
        item.addEventListener('dragend', ()=>{ dragSrc=null; item.classList.remove('dragging'); [...orderList.children].forEach(li=>li.classList.remove('drag-over')); });
        item.addEventListener('dragover', e=>{ e.preventDefault(); e.dataTransfer.dropEffect='move'; if(item!==dragSrc) item.classList.add('drag-over'); });
        item.addEventListener('dragleave', ()=> item.classList.remove('drag-over'));
        item.addEventListener('drop', e=>{
          e.preventDefault();
          if(item!==dragSrc){
            const children = [...orderList.children];
            const srcIndex = children.indexOf(dragSrc);
            const tgtIndex = children.indexOf(item);
            if(srcIndex < tgtIndex) orderList.insertBefore(dragSrc, item.nextSibling);
            else orderList.insertBefore(dragSrc, item);
          }
          [...orderList.children].forEach(li=>li.classList.remove('drag-over'));
        });
      });
    }
    renderOrder(true);

    document.getElementById('checkOrder').addEventListener('click', ()=>{
      const ids = [...orderList.children].map(li=>li.dataset.id);
      const ok = JSON.stringify(ids) === JSON.stringify(correctOrder);
      const out = document.getElementById('orderFeedback');
      if(ok){ toast(out, "Chính xác! Bạn đã sắp xếp đúng quy trình.", "success"); addPoints(2); }
      else{ toast(out, "Chưa đúng. Gợi ý: Bắt đầu từ Properties → Sharing → Share…", "danger"); }
    });
    document.getElementById('revealOrder').addEventListener('click', ()=>{
      document.getElementById('orderReveal').style.display='block';
      renderOrder(false);
    });

    // -----------------------------
    // Activity 2: MCQ
    // -----------------------------
    const mcqAnswer = { q1:"A", q2:"B", q3:"A" };
    function markMCQ(){
      let score = 0;
      ['q1','q2','q3'].forEach(q=>{
        const selected = document.querySelector('input[name="'+q+'"]:checked');
        const choices = [...document.querySelectorAll('input[name="'+q+'"]')].map(inp=>inp.closest('.choice'));
        choices.forEach(c=>{ c.classList.remove('correct','incorrect'); });
        if(selected){
          const val = selected.value;
          const choiceElem = selected.closest('.choice');
          if(val === mcqAnswer[q]){ choiceElem.classList.add('correct'); score++; }
          else{ choiceElem.classList.add('incorrect'); }
        }
      });
      const fb = document.getElementById('mcqFeedback');
      if(score===3){ toast(fb, "Tuyệt vời! 3/3 câu đúng.", "success"); addPoints(3); }
      else{ toast(fb, "Bạn đúng "+score+"/3. Xem lại đáp án để hiểu rõ hơn.", "warning"); }
    }
    document.getElementById('checkMCQ').addEventListener('click', markMCQ);
    document.getElementById('revealMCQ').addEventListener('click', ()=>{ document.getElementById('mcqReveal').style.display='block'; });

    // -----------------------------
    // Activity 3: Drag & drop match
    // -----------------------------
    const tokens = [
      { id:'t1', label:'Network Sharing', value:'network', hint:'Chia sẻ nhanh qua Share…' },
      { id:'t2', label:'Advanced Sharing', value:'advanced', hint:'Tùy chọn nâng cao / hủy chia sẻ' },
      { id:'t3', label:'Password Protection', value:'password', hint:'Yêu cầu xác thực' },
      { id:'t4', label:'Everyone', value:'everyone', hint:'Nhóm người dùng trong mạng' },
    ];
    const bank = document.getElementById('bank');
    function renderTokens(){
      bank.innerHTML = "";
      tokens.forEach(t=>{
        const chip = document.createElement('div');
        chip.className = 'sortable-item';
        chip.draggable = true;
        chip.dataset.value = t.value;
        chip.innerHTML = '<span class="handle bi bi-arrows-move"></span><span class="fw-semibold">'+t.label+'</span><span class="ms-2 text-muted small">('+t.hint+')</span>';
        bank.appendChild(chip);
      });
      attachDrag(chipSelectorAll());
    }
    function chipSelectorAll(){
      return [...document.querySelectorAll('#bank .sortable-item, .list-group .drop-target .sortable-item')];
    }
    function attachDrag(items){
      let drag = null;
      items.forEach(el=>{
        el.addEventListener('dragstart', e=>{ drag = el; el.classList.add('dragging'); e.dataTransfer.effectAllowed='move'; });
        el.addEventListener('dragend', ()=>{ drag=null; el.classList.remove('dragging'); document.querySelectorAll('.drop-target').forEach(d=>d.classList.remove('drag-over')); });
      });
      document.querySelectorAll('.drop-target').forEach(target=>{
        target.addEventListener('dragover', e=>{ e.preventDefault(); target.classList.add('drag-over'); });
        target.addEventListener('dragleave', ()=> target.classList.remove('drag-over'));
        target.addEventListener('drop', e=>{
          e.preventDefault();
          target.classList.remove('drag-over');
          if(!drag) return;
          // Each target holds max 1 chip
          if(target.querySelector('.sortable-item')) bank.appendChild(target.querySelector('.sortable-item'));
          target.appendChild(drag);
        });
      });
    }
    renderTokens();

    document.getElementById('checkMatch').addEventListener('click', ()=>{
      let correct = 0;
      document.querySelectorAll('.list-group .drop-target').forEach(t=>{
        const chip = t.querySelector('.sortable-item');
        if(chip && chip.dataset.value === t.dataset.accept) correct++;
      });
      const fb = document.getElementById('matchFeedback');
      if(correct===4){ toast(fb, "Xuất sắc! Ghép đúng 4/4.", "success"); addPoints(3); }
      else{ toast(fb, "Bạn đúng "+correct+"/4. Kéo thả lại cho chính xác nhé.", "warning"); }
    });
    document.getElementById('revealMatch').addEventListener('click', ()=>{
      // Auto place correct tokens
      document.querySelectorAll('.list-group .drop-target').forEach(t=>{
        const val = t.dataset.accept;
        const chip = [...bank.children, ...document.querySelectorAll('.list-group .drop-target .sortable-item')].find(c=>c.dataset.value===val);
        if(chip){ if(t.querySelector('.sortable-item')) bank.appendChild(t.querySelector('.sortable-item')); t.appendChild(chip); }
      });
      document.getElementById('matchReveal').style.display='block';
    });

    // -----------------------------
    // Activity 4: Scenario
    // -----------------------------
    document.getElementById('checkScenario').addEventListener('click', ()=>{
      let score = 0;
      document.querySelectorAll('.scenario').forEach(sel=>{
        const ans = sel.dataset.answer;
        const val = sel.value;
        const hint = sel.parentElement.querySelector('.small');
        if(val === ans){ hint.innerHTML = '<span class="text-success"><i class="bi bi-check-circle me-1"></i>Đúng</span>'; score++; }
        else if(val===""){ hint.innerHTML = '<span class="text-warning"><i class="bi bi-exclamation-circle me-1"></i>Chưa chọn</span>'; }
        else{ hint.innerHTML = '<span class="text-danger"><i class="bi bi-x-circle me-1"></i>Chưa đúng</span>'; }
      });
      if(score===2){ addPoints(2); }
    });

    // -----------------------------
    // Activity 5: Short answer (keyword check)
    // -----------------------------
    const keywords = [
      /properties/i, /sharing/i, /advanced/i, /share this folder/i, /bỏ.*dấu|uncheck/i, /apply|ok/i
    ];
    document.getElementById('checkShort').addEventListener('click', ()=>{
      const text = document.getElementById('shortAns').value.trim();
      const fb = document.getElementById('shortFeedback');
      if(!text){ toast(fb, "Hãy nhập câu trả lời của bạn.", "warning"); return; }
      let hit = 0;
      keywords.forEach(re=>{ if(re.test(text)) hit++; });
      if(hit >= 4){ toast(fb, "Tốt! Bạn nêu đủ ý chính để hủy chia sẻ.", "success"); addPoints(2); }
      else{ toast(fb, "Còn thiếu ý. Gợi ý: Properties → Sharing → Advanced Sharing… → bỏ chọn “Share this folder”.", "danger"); }
    });
    document.getElementById('revealShort').addEventListener('click', ()=>{ document.getElementById('shortReveal').style.display='block'; });

    // -----------------------------
    // Grade all & Reset
    // -----------------------------
    document.getElementById('gradeAll').addEventListener('click', ()=>{
      // Trigger each check (no double points if clicked multiple times carelessly)
      // We will simply run checks; user controls points by clicking once logically.
      document.getElementById('checkOrder').click();
      document.getElementById('checkMCQ').click();
      document.getElementById('checkMatch').click();
      document.getElementById('checkScenario').click();
      document.getElementById('checkShort').click();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    document.getElementById('btnReset').addEventListener('click', ()=>{
      // Reset choices & UI
      resetPoints();

      renderOrder(true);
      document.getElementById('orderFeedback').innerHTML = "";
      document.getElementById('orderReveal').style.display='none';

      document.querySelectorAll('.choice').forEach(c=>c.classList.remove('correct','incorrect'));
      document.querySelectorAll('input[type="radio"]').forEach(r=>r.checked=false);
      document.getElementById('mcqFeedback').innerHTML = "";
      document.getElementById('mcqReveal').style.display='none';

      renderTokens();
      document.getElementById('matchFeedback').innerHTML = "";
      document.getElementById('matchReveal').style.display='none';

      document.querySelectorAll('.scenario').forEach(s=>{ s.value=""; const hint=s.parentElement.querySelector('.small'); if(hint) hint.innerHTML=""; });

      document.getElementById('shortAns').value="";
      document.getElementById('shortFeedback').innerHTML="";
      document.getElementById('shortReveal').style.display='none';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
