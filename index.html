<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mô Phỏng: Chia Sẻ Tệp và Thư Mục</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        /* Sử dụng font hệ thống cho giao diện giống Windows */
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            user-select: none;
        }

        /* Tùy chỉnh thanh cuộn */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        
        /* Hiệu ứng active cho nút bấm giống Windows */
        .win-button:active {
            border-color: #005a9e;
            background-color: #cce8ff;
        }

        /* Lớp phủ cho thư mục đã được chia sẻ */
        .shared-overlay {
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 32px;
            height: 16px;
            background-color: #2578d9;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .shared-overlay::before {
            content: '';
            position: absolute;
            width: 24px;
            height: 2px;
            background-color: #fff;
        }
    </style>
</head>
<body class="bg-[#f0f0f0] flex flex-col lg:flex-row p-2 sm:p-4 gap-4 h-screen overflow-hidden">

    <!-- Cột Hướng Dẫn -->
    <div class="lg:w-1/3 bg-white rounded-lg shadow-md p-4 flex flex-col h-1/2 lg:h-full overflow-y-auto">
        <h1 class="text-xl font-bold text-[#003366] mb-4">Hướng Dẫn Thực Hành</h1>
        <div id="task-list" class="space-y-3 text-sm">
            <div id="task-2" class="p-3 bg-gray-50 rounded-md border border-gray-200">
                <h2 class="font-semibold text-lg mb-2">Nhiệm vụ 2: Chia sẻ thư mục</h2>
                <div id="t2s1" class="task-step" data-task="t2s1">1. Mở thuộc tính của thư mục <strong>SÁCH LỚP 12</strong> trên <strong>MAY_1</strong>.</div>
                <div id="t2s2" class="task-step" data-task="t2s2">2. Trong thẻ <strong>Sharing</strong>, nhấp vào nút <strong>Share...</strong></div>
                <div id="t2s3" class="task-step" data-task="t2s3">3. Chọn <strong>Everyone</strong>, thêm vào danh sách và nhấn <strong>Share</strong>.</div>
                <div id="t2s4" class="task-step" data-task="t2s4">4. Từ <strong>MAY_2</strong>, truy cập vào <strong>MAY_1</strong> qua <strong>Network</strong> để xem thư mục đã chia sẻ.</div>
            </div>
            <div id="task-3" class="p-3 bg-gray-50 rounded-md border border-gray-200">
                <h2 class="font-semibold text-lg mb-2">Nhiệm vụ 3: Hủy bỏ chia sẻ</h2>
                <div id="t3s1" class="task-step" data-task="t3s1">1. Mở thuộc tính thư mục <strong>SÁCH LỚP 12</strong>, vào thẻ <strong>Sharing</strong> và chọn <strong>Advanced Sharing...</strong></div>
                <div id="t3s2" class="task-step" data-task="t3s2">2. Bỏ chọn "Share this folder" và nhấn <strong>OK</strong>.</div>
            </div>
        </div>
        <button id="reset-button" class="mt-auto w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 win-button transition-colors">Làm lại từ đầu</button>
    </div>

    <!-- Cửa Sổ File Explorer Giả Lập -->
    <div class="lg:w-2/3 bg-[#eff6fc] rounded-lg shadow-lg flex flex-col h-1/2 lg:h-full border border-gray-300">
        <!-- Thanh tiêu đề -->
        <div class="bg-gray-100 border-b border-gray-300 p-1 flex items-center gap-2 rounded-t-lg">
            <div class="flex gap-1">
                <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                <div class="w-3 h-3 bg-yellow-400 rounded-full"></div>
                <div class="w-3 h-3 bg-green-500 rounded-full"></div>
            </div>
            <p class="text-sm font-semibold ml-2">File Explorer</p>
        </div>

        <!-- Thanh địa chỉ -->
        <div class="bg-white p-1 border-b border-gray-300 flex items-center">
            <i class="fas fa-arrow-left text-gray-400 p-1"></i>
            <i class="fas fa-arrow-right text-gray-600 p-1 mx-1"></i>
            <div class="flex-grow bg-gray-100 border border-gray-300 rounded p-1 text-sm flex items-center">
                <i class="fa-solid fa-network-wired text-blue-700 mr-2"></i>
                <span id="address-bar">Network</span>
            </div>
        </div>

        <!-- Nội dung chính -->
        <div class="flex flex-1 overflow-hidden">
            <!-- Khung điều hướng bên trái -->
            <div class="w-1/4 bg-gray-50 p-2 border-r border-gray-200 overflow-y-auto">
                <div id="nav-network" class="nav-item p-2 rounded cursor-pointer bg-blue-100 border border-blue-300">
                    <i class="fa-solid fa-network-wired fa-fw mr-2 text-blue-700"></i><span class="text-sm font-medium">Network</span>
                </div>
            </div>

            <!-- Khung hiển thị tệp/thư mục -->
            <div id="main-content" class="w-3/4 p-4 flex-1 overflow-y-auto grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-6">
                <!-- Nội dung sẽ được tạo bởi JavaScript -->
            </div>
        </div>
    </div>

    <!-- Menu chuột phải (Context Menu) -->
    <div id="context-menu" class="hidden absolute bg-white border border-gray-300 rounded shadow-lg p-1 text-sm z-50">
        <div id="context-properties" class="px-3 py-1 hover:bg-blue-500 hover:text-white rounded cursor-pointer">Properties</div>
    </div>

    <!-- Cửa sổ Properties -->
    <div id="properties-window" class="hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-11/12 sm:w-96 bg-gray-100 border border-gray-400 shadow-2xl rounded-lg z-40 flex flex-col">
        <div class="bg-white px-3 py-1 font-bold text-sm border-b border-gray-300 flex justify-between items-center">
            <span id="properties-title">Properties</span>
            <button id="close-properties" class="font-bold text-gray-600 hover:text-red-500">&times;</button>
        </div>
        <div class="flex border-b border-gray-300 text-sm">
            <button class="tab-button px-3 py-1 border-b-2 border-blue-500 bg-white" data-tab="general">General</button>
            <button class="tab-button px-3 py-1" data-tab="sharing">Sharing</button>
            <button class="tab-button px-3 py-1" data-tab="security">Security</button>
        </div>
        <div class="p-4 flex-grow text-sm space-y-4">
            <!-- Tab General -->
            <div class="tab-content" id="tab-general">
                <p><strong>Size:</strong> 1.25 MB</p>
                <p><strong>Contains:</strong> 15 Files, 2 Folders</p>
            </div>
            <!-- Tab Sharing -->
            <div class="tab-content hidden" id="tab-sharing">
                <h3 class="font-semibold">Network File and Folder Sharing</h3>
                <p class="text-xs text-gray-600 mb-2">Share folders with other people on the network.</p>
                <button id="share-button" class="bg-gray-200 border border-gray-400 px-8 py-1 rounded text-sm hover:bg-gray-300 win-button">Share...</button>
                <hr class="my-3">
                <h3 class="font-semibold">Advanced Sharing</h3>
                <p class="text-xs text-gray-600 mb-2">Set custom permissions, create multiple shares.</p>
                <button id="advanced-sharing-button" class="bg-gray-200 border border-gray-400 px-8 py-1 rounded text-sm hover:bg-gray-300 win-button">Advanced Sharing...</button>
            </div>
             <!-- Tab Security -->
            <div class="tab-content hidden" id="tab-security">
                <p>Object name: SÁCH LỚP 12</p>
                <p>To change permissions, click Edit.</p>
            </div>
        </div>
        <div class="bg-gray-200 p-2 border-t border-gray-300 flex justify-end gap-2">
            <button id="ok-properties" class="bg-gray-300 border border-gray-400 px-6 py-1 rounded text-sm win-button">OK</button>
            <button id="cancel-properties" class="bg-gray-300 border border-gray-400 px-6 py-1 rounded text-sm win-button">Cancel</button>
        </div>
    </div>
    
    <!-- Cửa sổ Share -->
    <div id="share-window" class="hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-11/12 sm:w-[450px] bg-white border border-gray-400 shadow-2xl rounded-lg z-50 flex flex-col">
        <div class="px-4 py-2 font-bold text-sm border-b border-gray-300">
            <span>Network access</span>
        </div>
        <div class="p-4 flex-grow text-sm space-y-2">
            <h2 class="text-lg">Choose people to share with</h2>
            <p class="text-xs">Type a name and click Add, or choose from the list.</p>
            <div class="flex">
                <select id="user-select" class="flex-grow border border-gray-400 p-1 rounded-l">
                    <option>Everyone</option>
                    <option>user11</option>
                    <option>user12</option>
                </select>
                <button id="add-user-button" class="bg-gray-200 border border-gray-400 px-4 rounded-r text-sm win-button">Add</button>
            </div>
            <div id="shared-users-list" class="border border-gray-300 h-24 p-1 overflow-y-auto">
                <!-- User list appears here -->
            </div>
        </div>
        <div class="bg-gray-100 p-2 border-t border-gray-300 flex justify-end gap-2">
            <button id="confirm-share-button" class="bg-blue-600 text-white px-6 py-1 rounded text-sm win-button">Share</button>
            <button id="cancel-share-button" class="bg-gray-200 border border-gray-400 px-6 py-1 rounded text-sm win-button">Cancel</button>
        </div>
    </div>
    
    <!-- Cửa sổ Advanced Sharing -->
    <div id="advanced-sharing-window" class="hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-11/12 sm:w-96 bg-gray-100 border border-gray-400 shadow-2xl rounded-lg z-50 flex flex-col">
         <div class="bg-white px-3 py-1 font-bold text-sm border-b border-gray-300 flex justify-between items-center">
            <span>Advanced Sharing</span>
            <button id="close-advanced" class="font-bold text-gray-600 hover:text-red-500">&times;</button>
        </div>
        <div class="p-4 flex-grow text-sm space-y-4">
             <label class="flex items-center">
                <input type="checkbox" id="share-folder-checkbox" class="mr-2">
                Share this folder
            </label>
        </div>
        <div class="bg-gray-200 p-2 border-t border-gray-300 flex justify-end gap-2">
            <button id="ok-advanced" class="bg-gray-300 border border-gray-400 px-6 py-1 rounded text-sm win-button">OK</button>
            <button id="cancel-advanced" class="bg-gray-300 border border-gray-400 px-6 py-1 rounded text-sm win-button">Cancel</button>
        </div>
    </div>

    <!-- Thông báo nhỏ -->
    <div id="toast" class="hidden fixed bottom-5 right-5 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg transition-opacity duration-300">
        Hoàn thành!
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // DOM Elements
    const mainContent = document.getElementById('main-content');
    const addressBar = document.getElementById('address-bar');
    const navNetwork = document.getElementById('nav-network');
    const contextMenu = document.getElementById('context-menu');
    const contextProperties = document.getElementById('context-properties');
    const propertiesWindow = document.getElementById('properties-window');
    const shareWindow = document.getElementById('share-window');
    const advancedSharingWindow = document.getElementById('advanced-sharing-window');
    const toast = document.getElementById('toast');
    const resetButton = document.getElementById('reset-button');
    
    // State
    let state = {};

    function initializeState() {
        state = {
            currentLocation: 'Network',
            longPressTimer: null,
            contextTarget: null,
            computers: {
                'MAY_1': {
                    folders: { 'SÁCH LỚP 12': { isShared: false } }
                },
                'MAY_2': {
                    folders: {}
                }
            },
            tasks: { t2s1: false, t2s2: false, t2s3: false, t2s4: false, t3s1: false, t3s2: false }
        };
        render();
        updateTaskListUI();
    }

    // --- RENDER LOGIC ---
    function render() {
        mainContent.innerHTML = '';
        addressBar.textContent = state.currentLocation;

        if (state.currentLocation === 'Network') {
            renderComputers();
        } else if (state.currentLocation.startsWith('MAY_')) {
            renderFolders(state.currentLocation);
        }
    }

    function renderComputers() {
        Object.keys(state.computers).forEach(name => {
            const computerDiv = createIcon(name, 'fa-desktop', 'computer');
            computerDiv.addEventListener('dblclick', () => navigateTo(name));
            computerDiv.addEventListener('click', () => navigateTo(name)); // For mobile
            mainContent.appendChild(computerDiv);
        });
    }

    function renderFolders(computerName) {
        if(computerName === 'MAY_1') {
            const folder = createIcon('SÁCH LỚP 12', 'fa-folder', 'folder');
            if(state.computers['MAY_1'].folders['SÁCH LỚP 12'].isShared){
                 folder.classList.add('shared');
                 const overlay = document.createElement('div');
                 overlay.className = 'shared-overlay';
                 folder.querySelector('div').appendChild(overlay);
            }
            mainContent.appendChild(folder);
        } else if (computerName === 'MAY_2') {
             const back = createIcon('Go to Network', 'fa-arrow-left', 'navigation');
             back.addEventListener('click', () => navigateTo('Network'));
             mainContent.appendChild(back);
             
             // Check if can see shared folder from MAY_1
             if (state.computers['MAY_1'].folders['SÁCH LỚP 12'].isShared) {
                const networkLocation = createIcon('MAY_1', 'fa-desktop', 'computer');
                networkLocation.addEventListener('click', () => {
                    if (state.tasks.t2s3) {
                       completeTask('t2s4');
                       mainContent.innerHTML = '';
                       const sharedFolder = createIcon('SÁCH LỚP 12', 'fa-folder', 'folder');
                       sharedFolder.classList.add('shared');
                       const overlay = document.createElement('div');
                       overlay.className = 'shared-overlay';
                       sharedFolder.querySelector('div').appendChild(overlay);
                       mainContent.appendChild(sharedFolder);
                       addressBar.textContent = `Network\\MAY_1`;
                    }
                });
                mainContent.appendChild(networkLocation);
             }
        }
    }

    function createIcon(name, iconClass, type) {
        const iconWrapper = document.createElement('div');
        iconWrapper.className = 'flex flex-col items-center text-center cursor-pointer p-2 rounded hover:bg-blue-100';
        iconWrapper.dataset.name = name;
        iconWrapper.dataset.type = type;
        
        const iconDiv = document.createElement('div');
        iconDiv.className = 'relative text-5xl text-yellow-500 mb-1';
        if(type === 'computer') iconDiv.className = 'relative text-5xl text-gray-600 mb-1';
        if(type === 'navigation') iconDiv.className = 'relative text-5xl text-blue-600 mb-1';
        
        const icon = document.createElement('i');
        icon.className = `fas ${iconClass}`;
        iconDiv.appendChild(icon);
        
        const text = document.createElement('span');
        text.className = 'text-xs break-words w-16';
        text.textContent = name;
        
        iconWrapper.appendChild(iconDiv);
        iconWrapper.appendChild(text);

        // Event listeners for context menu
        iconWrapper.addEventListener('contextmenu', (e) => showContextMenu(e, iconWrapper));
        iconWrapper.addEventListener('touchstart', (e) => handleTouchStart(e, iconWrapper));
        iconWrapper.addEventListener('touchend', handleTouchEnd);
        
        return iconWrapper;
    }

    // --- NAVIGATION ---
    function navigateTo(location) {
        state.currentLocation = location;
        render();
    }
    
    navNetwork.addEventListener('click', () => navigateTo('Network'));
    
    // --- TASK LOGIC ---
    function completeTask(task) {
        if (state.tasks[task]) return; // Already completed
        state.tasks[task] = true;
        updateTaskListUI();
        showToast(`Hoàn thành bước: ${task.replace('t','Nhiệm vụ ').replace('s',' bước ')}`);
    }

    function updateTaskListUI() {
        for (const task in state.tasks) {
            const el = document.getElementById(task);
            if (el) {
                if(state.tasks[task]) {
                    el.classList.add('text-green-600', 'line-through');
                    el.innerHTML = `<i class="fa-solid fa-check-circle mr-2"></i> ${el.innerText}`;
                } else {
                    el.classList.remove('text-green-600', 'line-through');
                    el.innerHTML = el.innerText.replace('✓ ', '');
                }
            }
        }
    }

    function showToast(message) {
        toast.textContent = message;
        toast.classList.remove('hidden');
        setTimeout(() => { toast.classList.add('hidden'); }, 2000);
    }

    // --- CONTEXT MENU LOGIC (Right-click & Long-press) ---
    function showContextMenu(e, target) {
        e.preventDefault();
        if (target.dataset.type !== 'folder' || target.dataset.name !== 'SÁCH LỚP 12' || state.currentLocation !== 'MAY_1') {
            return;
        }
        state.contextTarget = target;
        contextMenu.style.top = `${e.pageY}px`;
        contextMenu.style.left = `${e.pageX}px`;
        contextMenu.classList.remove('hidden');
    }

    function handleTouchStart(e, target) {
        state.longPressTimer = setTimeout(() => {
            e.preventDefault();
            const touch = e.touches[0];
            showContextMenu({ pageX: touch.pageX, pageY: touch.pageY, preventDefault: () => {} }, target);
        }, 500); // 500ms for long press
    }

    function handleTouchEnd() {
        clearTimeout(state.longPressTimer);
    }
    
    document.addEventListener('click', () => contextMenu.classList.add('hidden'));

    // --- MODAL WINDOWS LOGIC ---
    // Properties Window
    contextProperties.addEventListener('click', () => {
        if(state.contextTarget) {
            propertiesWindow.classList.remove('hidden');
            completeTask('t2s1');
        }
    });

    const closeButtons = [
        document.getElementById('close-properties'), 
        document.getElementById('ok-properties'), 
        document.getElementById('cancel-properties')
    ];
    closeButtons.forEach(btn => btn.addEventListener('click', () => propertiesWindow.classList.add('hidden')));
    
    const tabButtons = propertiesWindow.querySelectorAll('.tab-button');
    const tabContents = propertiesWindow.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            tabButtons.forEach(btn => {
                btn.classList.remove('border-blue-500', 'bg-white');
            });
            tabContents.forEach(content => content.classList.add('hidden'));
            
            button.classList.add('border-blue-500', 'bg-white');
            document.getElementById(`tab-${button.dataset.tab}`).classList.remove('hidden');
        });
    });

    // Share Window
    document.getElementById('share-button').addEventListener('click', () => {
        completeTask('t2s2');
        shareWindow.classList.remove('hidden');
    });

    document.getElementById('cancel-share-button').addEventListener('click', () => {
        shareWindow.classList.add('hidden');
    });

    document.getElementById('add-user-button').addEventListener('click', () => {
        const userList = document.getElementById('shared-users-list');
        const user = document.getElementById('user-select').value;
        if (user === 'Everyone' && !document.getElementById('user-everyone')) {
            userList.innerHTML += `<div id="user-everyone" class="flex justify-between items-center p-1"><span>Everyone</span><select><option>Read</option><option>Read/Write</option></select></div>`;
        }
    });
    
    document.getElementById('confirm-share-button').addEventListener('click', () => {
        if(document.getElementById('user-everyone')) {
            state.computers['MAY_1'].folders['SÁCH LỚP 12'].isShared = true;
            completeTask('t2s3');
            shareWindow.classList.add('hidden');
            propertiesWindow.classList.add('hidden');
            render();
        } else {
            alert('Bạn phải thêm "Everyone" vào danh sách trước khi chia sẻ.');
        }
    });

    // Advanced Sharing Window
    document.getElementById('advanced-sharing-button').addEventListener('click', () => {
        completeTask('t3s1');
        const checkbox = document.getElementById('share-folder-checkbox');
        checkbox.checked = state.computers['MAY_1'].folders['SÁCH LỚP 12'].isShared;
        advancedSharingWindow.classList.remove('hidden');
    });
    
    const closeAdvancedButtons = [
        document.getElementById('close-advanced'),
        document.getElementById('cancel-advanced')
    ];
    closeAdvancedButtons.forEach(btn => btn.addEventListener('click', () => advancedSharingWindow.classList.add('hidden')));

    document.getElementById('ok-advanced').addEventListener('click', () => {
        const isChecked = document.getElementById('share-folder-checkbox').checked;
        const wasShared = state.computers['MAY_1'].folders['SÁCH LỚP 12'].isShared;
        
        if (wasShared && !isChecked) {
            completeTask('t3s2');
            state.computers['MAY_1'].folders['SÁCH LỚP 12'].isShared = false;
        }
        
        advancedSharingWindow.classList.add('hidden');
        propertiesWindow.classList.add('hidden');
        render();
    });
    
    // Reset Button
    resetButton.addEventListener('click', initializeState);

    // Initial load
    initializeState();
});
</script>
</body>
</html>
